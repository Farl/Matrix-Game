# Matrix Game 2.0 Apple Silicon - é …ç›®æ–‡ä»¶çµæ§‹èªªæ˜

## ğŸ“‹ æ¦‚è¿°

é€™å€‹æ–‡æª”èªªæ˜äº†é …ç›®ä¸­å„å€‹æ–‡ä»¶å’Œæ–‡ä»¶å¤¾çš„ä½œç”¨ï¼Œä»¥åŠå“ªäº›æ‡‰è©²åŒ…å«åœ¨ Git ç‰ˆæœ¬æ§åˆ¶ä¸­ã€‚

## ğŸ—‚ï¸ é …ç›®çµæ§‹

```
Matrix-Game-Working/
â”œâ”€â”€ ğŸ“„ æ ¸å¿ƒä»£ç¢¼æ–‡ä»¶ (âœ… åŒ…å«åœ¨ Git ä¸­)
â”‚   â”œâ”€â”€ inference.py                    # ä¸»æ¨ç†è…³æœ¬ (Apple Silicon é©é…)
â”‚   â”œâ”€â”€ inference_streaming.py          # ä¸²æµæ¨ç†è…³æœ¬ (Apple Silicon é©é…)
â”‚   â”œâ”€â”€ setup.py                        # å®‰è£è…³æœ¬
â”‚   â”œâ”€â”€ requirements.txt                # Python ä¾è³´
â”‚   â””â”€â”€ pipeline/                       # æ¨ç†ç®¡é“
â”‚       â””â”€â”€ causal_inference.py
â”‚
â”œâ”€â”€ ğŸ“„ æ ¸å¿ƒæ¨¡çµ„ (âœ… åŒ…å«åœ¨ Git ä¸­)
â”‚   â””â”€â”€ wan/                            # æ ¸å¿ƒæ¨¡å‹æ¨¡çµ„
â”‚       â”œâ”€â”€ modules/
â”‚       â”‚   â”œâ”€â”€ model.py                # ä¸»æ¨¡å‹ (MPS ç²¾åº¦é©é…)
â”‚       â”‚   â”œâ”€â”€ attention.py            # æ³¨æ„åŠ›æ©Ÿåˆ¶ (Flash Attention å›é€€)
â”‚       â”‚   â”œâ”€â”€ causal_model.py         # å› æœæ¨¡å‹ (è¤‡æ•¸ç²¾åº¦é©é…)
â”‚       â”‚   â””â”€â”€ ...
â”‚       â””â”€â”€ vae/                        # VAE æ¨¡çµ„
â”‚
â”œâ”€â”€ ğŸ“„ é…ç½®æ–‡ä»¶ (âœ… åŒ…å«åœ¨ Git ä¸­)
â”‚   â””â”€â”€ configs/
â”‚       â”œâ”€â”€ inference_yaml/             # æ¨ç†é…ç½®
â”‚       â””â”€â”€ distilled_model/            # æ¨¡å‹é…ç½®
â”‚
â”œâ”€â”€ ğŸ“„ ç¤ºä¾‹æ–‡ä»¶ (âœ… åŒ…å«åœ¨ Git ä¸­)
â”‚   â””â”€â”€ demo_images/                    # ç¤ºä¾‹åœ–ç‰‡
â”‚       â”œâ”€â”€ universal/
â”‚       â”œâ”€â”€ gta_drive/
â”‚       â””â”€â”€ temple_run/
â”‚
â”œâ”€â”€ ğŸ“„ æ–‡æª”æ–‡ä»¶ (âœ… åŒ…å«åœ¨ Git ä¸­)
â”‚   â”œâ”€â”€ README.md                       # ä¸»æ–‡æª” (å·²æ›´æ–° Apple Silicon æ”¯æ´)
â”‚   â”œâ”€â”€ README_Apple_Silicon.md         # Apple Silicon ç‰¹å®šèªªæ˜
â”‚   â”œâ”€â”€ FINAL_VERIFICATION_REPORT.md    # æœ€çµ‚é©—è­‰å ±å‘Š
â”‚   â”œâ”€â”€ APPLE_SILICON_CHANGES.md        # æŠ€è¡“è®Šæ›´è¨˜éŒ„
â”‚   â”œâ”€â”€ MODELS_SETUP.md                 # æ¨¡å‹è¨­ç½®æŒ‡å— (æ–°)
â”‚   â””â”€â”€ PROJECT_STRUCTURE.md            # æœ¬æ–‡æª” (æ–°)
â”‚
â”œâ”€â”€ ğŸ“„ è‡ªå‹•åŒ–è…³æœ¬ (âœ… åŒ…å«åœ¨ Git ä¸­)
â”‚   â”œâ”€â”€ download_models.sh              # æ¨¡å‹è‡ªå‹•ä¸‹è¼‰è…³æœ¬ (æ–°)
â”‚   â””â”€â”€ .gitignore                      # Git å¿½ç•¥è¦å‰‡ (æ–°)
â”‚
â”œâ”€â”€ ğŸ“ æ¨¡å‹æ–‡ä»¶ (âŒ ä¸åŒ…å«åœ¨ Git ä¸­)
â”‚   â””â”€â”€ Matrix-Game-2.0/                # å¤§å‹æ¨¡å‹æ–‡ä»¶æ–‡ä»¶å¤¾
â”‚       â”œâ”€â”€ Wan2.1_VAE.pth              # VAE æ¨¡å‹ (~8GB)
â”‚       â”œâ”€â”€ base_distilled_model/
â”‚       â”‚   â””â”€â”€ base_distill.safetensors # åŸºç¤æ¨¡å‹ (~10GB)
â”‚       â”œâ”€â”€ base_model/
â”‚       â”‚   â””â”€â”€ diffusion_pytorch_model.safetensors # (~20GB)
â”‚       â”œâ”€â”€ gta_distilled_model/
â”‚       â”‚   â””â”€â”€ gta_keyboard2dim.safetensors # GTA æ¨¡å‹ (~5GB)
â”‚       â”œâ”€â”€ templerun_distilled_model/
â”‚       â”‚   â””â”€â”€ templerun_7dim_onlykey.safetensors # Temple Run æ¨¡å‹ (~5GB)
â”‚       â”œâ”€â”€ models_clip_*.pth           # CLIP æ¨¡å‹ (~2GB)
â”‚       â””â”€â”€ xlm-roberta-large/          # èªè¨€æ¨¡å‹æ–‡ä»¶å¤¾ (~2GB)
â”‚
â””â”€â”€ ğŸ“ è¼¸å‡ºæ–‡ä»¶ (âŒ ä¸åŒ…å«åœ¨ Git ä¸­)
    â”œâ”€â”€ test_outputs/                   # æ¸¬è©¦è¼¸å‡º (ç”Ÿæˆçš„å½±ç‰‡)
    â”œâ”€â”€ test_outputs_streaming/         # ä¸²æµæ¸¬è©¦è¼¸å‡º
    â””â”€â”€ outputs/                        # ç”¨æˆ¶è¼¸å‡ºæ–‡ä»¶å¤¾
```

## ğŸ”„ Git ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥

### âœ… **åŒ…å«åœ¨ Git ä¸­çš„æ–‡ä»¶**
- **æºä»£ç¢¼**: æ‰€æœ‰ `.py` æ–‡ä»¶å’Œæ¨¡çµ„
- **é…ç½®æ–‡ä»¶**: YAML é…ç½®å’Œ JSON è¨­ç½®
- **ç¤ºä¾‹è³‡æº**: å°å‹ç¤ºä¾‹åœ–ç‰‡ (< 1MB)
- **æ–‡æª”**: READMEã€èªªæ˜æ–‡æª”ã€å ±å‘Š
- **è…³æœ¬**: å®‰è£å’Œè‡ªå‹•åŒ–è…³æœ¬
- **å…ƒæ•¸æ“š**: requirements.txtã€setup.py ç­‰

### âŒ **ä¸åŒ…å«åœ¨ Git ä¸­çš„æ–‡ä»¶** 
- **å¤§å‹æ¨¡å‹æ–‡ä»¶**: `.safetensors`, `.pth`, `.bin` (ç”± `.gitignore` æ’é™¤)
- **è¼¸å‡ºæ–‡ä»¶**: ç”Ÿæˆçš„å½±ç‰‡å’Œä¸­é–“çµæœ
- **ç·©å­˜æ–‡ä»¶**: `__pycache__/`, `.cache/`
- **è‡¨æ™‚æ–‡ä»¶**: æ—¥èªŒã€èª¿è©¦è¼¸å‡º
- **ç’°å¢ƒç›¸é—œ**: è™›æ“¬ç’°å¢ƒæ–‡ä»¶å¤¾

## ğŸ”— æ¨¡å‹æ–‡ä»¶ç®¡ç†

### ç¬¦è™Ÿéˆæ¥æ©Ÿåˆ¶
```bash
Matrix-Game-2.0/base_distilled_model/base_distill.safetensors 
â””â”€â”€ ç¬¦è™Ÿéˆæ¥æŒ‡å‘ â†’ ~/.cache/huggingface/hub/models--Skywork--Matrix-Game-2.0/blobs/xxx
```

**å„ªé»**:
- å¤šå€‹é …ç›®å…±äº«åŒä¸€å¥—æ¨¡å‹
- ç¯€çœç£ç›¤ç©ºé–“
- è‡ªå‹•ç·©å­˜ç®¡ç†
- Git å‹å¥½ (ç¬¦è™Ÿéˆæ¥å¾ˆå°)

### è‡ªå‹•ä¸‹è¼‰æµç¨‹
1. **é‹è¡Œè…³æœ¬**: `bash download_models.sh`
2. **Hugging Face CLI** ä¸‹è¼‰æ¨¡å‹åˆ°ç·©å­˜
3. **å‰µå»ºç¬¦è™Ÿéˆæ¥** æŒ‡å‘ç·©å­˜ä¸­çš„æ–‡ä»¶
4. **é©—è­‰å®Œæ•´æ€§** ç¢ºä¿æ‰€æœ‰æ¨¡å‹æ–‡ä»¶å°±ä½

## ğŸ“Š ç£ç›¤ç©ºé–“ä½¿ç”¨

| é¡åˆ¥ | å¤§å° | èªªæ˜ |
|------|------|------|
| **æºä»£ç¢¼** | ~10 MB | åŒ…å«åœ¨ Git ä¸­ |
| **é…ç½®å’Œæ–‡æª”** | ~5 MB | åŒ…å«åœ¨ Git ä¸­ |
| **ç¤ºä¾‹åœ–ç‰‡** | ~50 MB | åŒ…å«åœ¨ Git ä¸­ |
| **æ¨¡å‹æ–‡ä»¶** | ~50 GB | ä¸åŒ…å«åœ¨ Git (ç¬¦è™Ÿéˆæ¥) |
| **è¼¸å‡ºæ–‡ä»¶** | è®Šå‹• | ä¸åŒ…å«åœ¨ Git |

## ğŸš€ æ–°ç”¨æˆ¶è¨­ç½®æµç¨‹

1. **Clone å„²å­˜åº«**:
   ```bash
   git clone [your-repo-url] Matrix-Game-Working
   cd Matrix-Game-Working
   ```

2. **å®‰è£ä¾è³´**:
   ```bash
   pip install -r requirements.txt
   python setup.py develop
   ```

3. **ä¸‹è¼‰æ¨¡å‹**:
   ```bash
   bash download_models.sh
   ```

4. **é©—è­‰è¨­ç½®**:
   ```bash
   # æª¢æŸ¥æ¨¡å‹æ˜¯å¦å°±ä½
   ls -la Matrix-Game-2.0/
   ```

5. **é‹è¡Œæ¨ç†**:
   ```bash
   PYTORCH_MPS_HIGH_WATERMARK_RATIO=0.0 TORCH_COMPILE_DISABLE=1 python inference.py \
     --config_path configs/inference_yaml/inference_universal.yaml \
     --checkpoint_path Matrix-Game-2.0/base_distilled_model/base_distill.safetensors \
     --img_path demo_images/universal/0000.png \
     --output_folder outputs \
     --num_output_frames 5 \
     --seed 42 \
     --pretrained_model_path Matrix-Game-2.0
   ```

## ğŸ”§ ç¶­è­·æ³¨æ„äº‹é …

### é–‹ç™¼è€…
- **æäº¤ä»£ç¢¼å‰**: ç¢ºèªæ²’æœ‰æ„å¤–åŒ…å«å¤§æ–‡ä»¶
- **æ¸¬è©¦è¼¸å‡º**: æ¸…ç† `test_outputs/` æ–‡ä»¶å¤¾
- **ä¾è³´æ›´æ–°**: åŠæ™‚æ›´æ–° `requirements.txt`

### ç”¨æˆ¶
- **å®šæœŸæ¸…ç†**: åˆªé™¤ä¸éœ€è¦çš„è¼¸å‡ºæ–‡ä»¶
- **ç©ºé–“ç›£æ§**: é—œæ³¨ Hugging Face ç·©å­˜å¤§å°
- **æ›´æ–°æ¨¡å‹**: é‡æ–°é‹è¡Œ `download_models.sh` ç²å–æœ€æ–°ç‰ˆæœ¬

---

**ç¸½çµ**: é€™å€‹é …ç›®çµæ§‹è¨­è¨ˆç¢ºä¿äº†ä»£ç¢¼å’Œé…ç½®çš„å®Œæ•´ç‰ˆæœ¬æ§åˆ¶ï¼ŒåŒæ™‚é¿å…äº†å¤§æ–‡ä»¶å¸¶ä¾†çš„å•é¡Œã€‚é€šéè‡ªå‹•åŒ–è…³æœ¬å’Œç¬¦è™Ÿéˆæ¥æ©Ÿåˆ¶ï¼Œæä¾›äº†æµæš¢çš„ç”¨æˆ¶é«”é©—ã€‚